# Version 1.2.0 - New Features & Fixes

## üéâ New Features

### 1. ‚úÖ Export Format Dropdown
**What's New:** Export button now has a dropdown menu with multiple format options!

**Formats Available:**
- **JSON** - Structured data format (original)
- **Markdown** - For documentation and notes (with formatting)
- **Text** - Plain text format (simple and universal)
- **HTML** - Styled webpage format (beautiful in browser)

**How to Use:**
1. Click "Export ‚ñº" button
2. Select your preferred format
3. File downloads automatically with proper extension

**Example Outputs:**

**Markdown:**
```markdown
**You:**

How does photosynthesis work?

---

**ChatGPT:**

Photosynthesis is the process...

---
```

**HTML:**
```html
<!DOCTYPE html>
<html>
  <body>
    <div class="message user">
      <div class="role">You</div>
      <div class="content">How does photosynthesis work?</div>
    </div>
    <div class="message assistant">
      <div class="role">ChatGPT</div>
      <div class="content">Photosynthesis is...</div>
    </div>
  </body>
</html>
```

**Text:**
```
You:
How does photosynthesis work?

============================================================

ChatGPT:
Photosynthesis is the process...

============================================================
```

---

### 2. ‚úÖ Message Count Presets & "Show All"
**What's New:** Dropdown next to the message count input with quick presets!

**Options:**
- Custom (use the number input)
- 10 messages
- 50 messages
- 100 messages
- **Show All** (shows entire conversation)

**Features:**
- Select preset from dropdown OR type custom number
- Dropdown auto-updates when you type a preset number
- "Show All" sets keepN to 999999 (effectively unlimited)
- Works seamlessly with manual input and pill controls

**How to Use:**
1. Open popup
2. Either:
   - Select preset from dropdown (10, 50, 100, Show All)
   - OR type custom number in input field
3. Click "Apply Settings"

---

### 3. ‚úÖ Archive Mode Tooltip
**What's New:** Helpful info icon (‚ìò) next to "Archive mode" that explains the difference!

**Tooltip Content:**
- **Storage mode:** Serializes messages to browser storage (uses less memory)
- **Hidden mode:** Keeps messages in hidden DOM (faster access but uses more memory)

**How to See It:**
- Hover your mouse over the blue ‚ìò icon
- Tooltip appears automatically
- Helps you choose the right mode for your needs

---

## üêõ Bug Fixes

### 1. ‚úÖ Opera Extension Context Invalidation Error
**Problem:** Extension crashed in Opera with "Extension context invalidated" error

**Fixed:**
- Wrapped `saveSettings()` in try-catch block
- Gracefully handles context invalidation
- Shows warning in console instead of crashing
- Settings still apply in current session

**What You'll See (if it happens):**
```
ChatGPT Speedup: Extension context invalidated. Settings will apply but won't persist. Reload the page to fix.
```

**Solution:** Just reload the ChatGPT page if you see this warning.

---

### 2. ‚úÖ Auto-Scroll to Top Fixed
**Problem:** When writing a new prompt, the page would automatically scroll to the top

**Fixed:**
- Saves scroll position before pruning
- Restores scroll position after pruning
- Uses `behavior: 'instant'` for seamless restoration
- Handles multiple scroll containers (main, window)

**Result:** No more unexpected scrolling! Page stays where you left it.

---

## üîß Technical Details

### Files Modified

**content.js:**
- Added `getAllMessagesForExport` message handler
- Added scroll position save/restore in `applyPruning()`
- Added try-catch in `saveSettings()` for Opera compatibility

**popup.html:**
- Added keepN preset dropdown
- Added info icon tooltip for Archive mode
- Added export format dropdown menu structure

**popup.css:**
- Added `.info-icon` styles (blue circle with ‚ìò)
- Added `.export-menu` dropdown styles
- Added `.export-option` button styles
- Responsive hover states

**popup.js:**
- Added `downloadText()` function for text exports
- Added export format handlers (JSON, Markdown, Text, HTML)
- Added keepN preset dropdown logic
- Added export menu toggle functionality
- Auto-sync between preset dropdown and manual input

---

## üìä Format Comparison

| Format | Best For | File Size | Readability | Styling |
|--------|----------|-----------|-------------|---------|
| JSON | Data processing, archives | Medium | Low | None |
| Markdown | Notes, documentation | Small | High | Basic |
| Text | Universal compatibility | Small | Medium | None |
| HTML | Beautiful display, sharing | Medium | High | Full |

**Recommendations:**
- **For archiving:** JSON (structured, easy to re-import)
- **For note-taking:** Markdown (clean, portable)
- **For sharing:** HTML (looks great in any browser)
- **For simplicity:** Text (works everywhere)

---

## üé® UI Improvements

### Info Icon
- Blue circle with white ‚ìò
- Hover changes to darker blue
- Native browser tooltip
- Accessible with keyboard

### Export Dropdown
- Clean white/dark themed menu
- Smooth hover transitions
- Closes when clicking outside
- Keyboard accessible

### Preset Dropdown
- Side-by-side with input field
- Auto-syncs with manual input
- Clean material design
- Responsive layout

---

## üß™ Testing Checklist

### Export Formats:
- [ ] JSON export creates valid JSON file
- [ ] Markdown export has proper formatting
- [ ] Text export is clean and readable
- [ ] HTML export displays correctly in browser
- [ ] Filename includes current date
- [ ] All messages are included

### Preset Dropdown:
- [ ] Selecting preset updates input field
- [ ] Typing preset value updates dropdown
- [ ] "Show All" shows entire conversation
- [ ] Custom values work correctly
- [ ] Applies properly when clicking "Apply Settings"

### Archive Mode Tooltip:
- [ ] Tooltip appears on hover
- [ ] Text is readable and helpful
- [ ] Works in both light and dark mode
- [ ] Doesn't interfere with clicking select

### Bug Fixes:
- [ ] No more scroll to top when writing prompts
- [ ] Opera extension doesn't crash
- [ ] Settings save properly (or warn gracefully)
- [ ] Scroll position maintained during pruning

---

## üöÄ Upgrade Instructions

**From v1.1.1:**
1. Pull latest code or download v1.2.0
2. Reload extension in browser
3. No settings changes needed
4. All new features work immediately

**New Users:**
1. Load extension
2. Open popup
3. Try the new export formats!
4. Use preset dropdown for quick settings

---

## üí° Tips & Tricks

### Export Tips:
1. **HTML export** - Open in browser, then Print to PDF for a styled PDF!
2. **Markdown export** - Import into Notion, Obsidian, or any markdown editor
3. **JSON export** - Use for backups or data analysis
4. **Text export** - Email, paste anywhere, universal format

### Preset Usage:
1. **Development:** Use "Show All" to see everything while debugging
2. **Performance:** Use 10-50 for max speed
3. **Research:** Use 100 for balance between speed and visibility

### Archive Mode:
1. **Storage mode** - Better for long conversations (saves RAM)
2. **Hidden mode** - Better for frequently accessing old messages

---

## üìù Known Limitations

### Export Formats:
- PDF not included (use HTML ‚Üí Print to PDF instead)
- DOCX not included (use Markdown ‚Üí import to Word)
- Images/attachments not captured (text only)

### Presets:
- "Show All" is actually 999999 (not truly infinite)
- Very large conversations may still slow down

### Opera:
- Context invalidation may still occur on page reloads
- Solution: Refresh page if you see the warning

---

## üéØ User Experience Impact

**Before v1.2.0:**
- Only JSON export
- Manual number input only
- No help text for archive mode
- Scrolled to top unexpectedly
- Crashed in Opera

**After v1.2.0:**
- 4 export formats with dropdown
- Quick presets + manual input
- Helpful tooltip for mode selection
- Scroll position maintained
- Graceful error handling in Opera

---

**Version:** 1.2.0 (unreleased - testing)
**Status:** Ready for testing
**Backward Compatible:** Yes
**Breaking Changes:** None
**Migration Required:** No

üéâ **All requested features implemented and all bugs fixed!**

